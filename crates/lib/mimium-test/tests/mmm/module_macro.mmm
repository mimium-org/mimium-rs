mod test{
    #stage(macro)
    pub fn macrofn1(x){
        `{$x+$x}
    }
}

// module ends in macro stage but it should be enclosed in local.
// global declaration still starts from main stage.
fn dsp(){
    $(test::macrofn1(`1))
}